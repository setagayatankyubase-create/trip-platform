<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="" id="meta-description">
  <title>ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´° | GreenTrails</title>
  <link rel="stylesheet" href="styles.css">
  <script type="application/ld+json" id="event-structured-data"></script>
  <style>
    .page {
      max-width: 1180px;
      margin: 26px auto;
      padding: 0 18px;
    }
    .breadcrumbs {
      color: #6b7b71;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    .breadcrumbs a {
      color: var(--primary);
      text-decoration: none;
    }
    .title {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 16px;
    }
    .title h1 {
      font-size: 1.8rem;
      margin: 0;
    }
    .gallery {
      margin: 16px 0;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 12px;
    }
    .gallery .main {
      height: 320px;
      background-size: cover;
      background-position: center;
      border-radius: 16px;
    }
    .thumbs {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .thumb {
      height: 155px;
      border-radius: 12px;
      background-size: cover;
      background-position: center;
    }
    .grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 18px;
      margin-top: 12px;
    }
    .card {
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 12px 26px var(--shadow);
      padding: 24px;
    }
    .card h3 {
      margin-bottom: 16px;
      font-size: 1.2rem;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 8px;
    }
    ul {
      padding-left: 20px;
      margin-bottom: 16px;
    }
    ul li {
      margin-bottom: 8px;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }
    .info-box {
      background: #f0f5f1;
      border-radius: 10px;
      padding: 12px;
      font-weight: 600;
    }
    .info-box-label {
      font-size: 0.85rem;
      color: #6c7a72;
      margin-bottom: 4px;
    }
    .booking {
      position: sticky;
      top: 80px;
      align-self: start;
    }
    .price {
      color: var(--primary);
      font-weight: 800;
      font-size: 1.3rem;
      margin: 16px 0;
    }
    .btn {
      display: block;
      text-align: center;
      background: var(--accent);
      color: #fff;
      text-decoration: none;
      padding: 16px;
      border-radius: 10px;
      font-weight: 800;
      margin-top: 16px;
      transition: background 0.2s;
    }
    .btn:hover {
      background: #e55a2e;
    }
    .btn-secondary {
      background: var(--primary);
      margin-top: 12px;
    }
    .btn-secondary:hover {
      background: var(--hover);
    }
    .dates-list {
      list-style: none;
      padding: 0;
    }
    .dates-list li {
      padding: 8px 12px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
    }
    .organizer-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      margin-top: 12px;
      transition: opacity 0.2s;
    }
    .organizer-link:hover {
      opacity: 0.8;
    }
    @media (max-width: 900px) {
      .gallery {
        grid-template-columns: 1fr;
      }
      .grid {
        grid-template-columns: 1fr;
      }
      .booking {
        position: static;
      }
    }

    @media (min-width: 901px) {
      .booking {
        position: sticky;
        top: 80px;
        max-height: calc(100vh - 100px);
        overflow-y: auto;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo">GreenTrails</div>
      <div class="nav-links">
        <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
        <a href="list.html">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</a>
        <a href="organizer-list.html">å‚¬è¡Œä¼šç¤¾</a>
      </div>
    </div>
  </header>

  <main class="page">
    <div id="breadcrumbs" class="breadcrumbs">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a> > <a href="list.html">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</a> > <span id="breadcrumb-category"></span>
    </div>

    <div class="title">
      <div>
        <h1 id="event-title"></h1>
        <div id="event-badges" style="margin-top: 8px;"></div>
      </div>
    </div>

    <div class="gallery">
      <div class="main" id="event-main-image"></div>
      <div class="thumbs">
        <div class="thumb" style="background-image: url('https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=800&q=80');"></div>
        <div class="thumb" style="background-image: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=800&q=80');"></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h3>æ¦‚è¦</h3>
        <p id="event-description"></p>

        <div class="info-grid">
          <div class="info-box">
            <div class="info-box-label">æ‰€è¦æ™‚é–“</div>
            <div id="event-duration"></div>
          </div>
          <div class="info-box">
            <div class="info-box-label">é›†åˆå ´æ‰€</div>
            <div id="event-location"></div>
          </div>
          <div class="info-box">
            <div class="info-box-label">å¯¾è±¡å¹´é½¢</div>
            <div id="event-target-age"></div>
          </div>
          <div class="info-box">
            <div class="info-box-label">ä¾¡æ ¼</div>
            <div>Â¥<span id="event-price"></span></div>
          </div>
        </div>

        <h3>é–‹å‚¬æ—¥ç¨‹</h3>
        <ul class="dates-list" id="event-dates"></ul>

        <h3>ãƒã‚¤ãƒ©ã‚¤ãƒˆ</h3>
        <ul id="event-highlights"></ul>

        <h3>æ³¨æ„äº‹é …</h3>
        <p id="event-notes"></p>

        <h3>å‚¬è¡Œä¼šç¤¾</h3>
        <div id="organizer-info"></div>
        <a href="#" id="organizer-link" class="organizer-link">
          å‚¬è¡Œä¼šç¤¾ã®è©³ç´°ã‚’è¦‹ã‚‹ â†’
        </a>
      </div>

      <div class="card booking">
        <h3>äºˆç´„</h3>
        <div class="price">Â¥<span id="booking-price"></span> / äºº</div>
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">
          æ—¥ä»˜
          <select id="booking-date" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 10px; margin-top: 6px;">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          </select>
        </label>
        <label style="display: block; margin-top: 12px; margin-bottom: 8px; font-weight: 600;">
          äººæ•°
          <select id="booking-people" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 10px; margin-top: 6px;">
            <option>1å</option>
            <option>2å</option>
            <option>3å</option>
            <option>4å</option>
            <option>5åä»¥ä¸Š</option>
          </select>
        </label>
        <a href="#" id="external-booking-btn" class="btn" target="_blank" rel="noopener">
          å¤–éƒ¨ã‚µã‚¤ãƒˆã§äºˆç´„ã™ã‚‹
        </a>
        <div style="margin-top: 12px; font-size: 0.92rem; color: #5b6a62;">
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç„¡æ–™ï¼ˆ24æ™‚é–“å‰ã¾ã§ï¼‰ã€‚å®‰å…¨è£…å‚™ãƒ¬ãƒ³ã‚¿ãƒ«è¾¼ã¿ã€‚
        </div>
      </div>
    </div>
  </main>

  <footer style="margin: 44px auto 20px; padding: 0 18px; text-align: center; color: #6c7a72; font-size: 0.92rem;">
    Â© 2025 GreenTrails. è‡ªç„¶ä½“é¨“ã‚’ã‚‚ã£ã¨èº«è¿‘ã«ã€‚
  </footer>

  <script src="data.js"></script>
  <script>
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆIDã‚’å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const eventId = urlParams.get('id');

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const event = eventData.events.find(e => e.id === eventId);
    const organizer = event ? eventData.organizers.find(o => o.id === event.organizerId) : null;

    if (event) {
      // ã‚¿ã‚¤ãƒˆãƒ«
      document.getElementById('event-title').textContent = event.title;
      document.title = `${event.title} | GreenTrails`;
      document.getElementById('meta-description').content = event.description;

      // æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
      const structuredData = {
        "@context": "https://schema.org",
        "@type": "Event",
        "name": event.title,
        "description": event.description,
        "image": event.image,
        "startDate": event.dates[0] ? `${event.dates[0].date}T${event.dates[0].time}:00` : "",
        "location": {
          "@type": "Place",
          "name": event.location ? event.location.name : `${event.area}, ${event.prefecture}`,
          "address": {
            "@type": "PostalAddress",
            "addressLocality": event.area,
            "addressRegion": event.prefecture
          }
        },
        "offers": {
          "@type": "Offer",
          "price": event.price,
          "priceCurrency": "JPY"
        }
      };
      document.getElementById('event-structured-data').textContent = JSON.stringify(structuredData);

      // ãƒãƒƒã‚¸
      const badgesContainer = document.getElementById('event-badges');
      const badges = [];
      if (event.isRecommended) badges.push('<span class="badge recommended">ãŠã™ã™ã‚</span>');
      if (event.isNew) badges.push('<span class="badge new">æ–°ç€</span>');
      if (event.externalLink) badges.push('<span class="badge external-link">å¤–éƒ¨ç”³è¾¼å¯</span>');
      badgesContainer.innerHTML = badges.join('');

      // ç”»åƒ
      document.getElementById('event-main-image').style.backgroundImage = `url('${event.image}')`;

      // ãƒ‘ãƒ³ããš
      const category = eventData.categories.find(c => c.id === event.categoryId);
      document.getElementById('breadcrumb-category').textContent = category ? category.name : event.category;

      // èª¬æ˜
      document.getElementById('event-description').textContent = event.description;

      // æƒ…å ±
      document.getElementById('event-duration').textContent = event.duration;
      document.getElementById('event-location').textContent = event.location ? event.location.name : `${event.area}, ${event.prefecture}`;
      document.getElementById('event-target-age').textContent = event.targetAge || 'å…¨å¹´é½¢';
      document.getElementById('event-price').textContent = event.price.toLocaleString();
      document.getElementById('booking-price').textContent = event.price.toLocaleString();

      // é–‹å‚¬æ—¥ç¨‹
      const datesList = document.getElementById('event-dates');
      const bookingDateSelect = document.getElementById('booking-date');
      event.dates.forEach(d => {
        const dateObj = new Date(d.date);
        const dateStr = `${dateObj.getFullYear()}å¹´${dateObj.getMonth() + 1}æœˆ${dateObj.getDate()}æ—¥`;
        const weekday = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][dateObj.getDay()];

        const li = document.createElement('li');
        li.innerHTML = `<span>${dateStr}(${weekday}) ${d.time}</span>`;
        datesList.appendChild(li);

        const option = document.createElement('option');
        option.value = d.date;
        option.textContent = `${dateStr}(${weekday}) ${d.time}`;
        bookingDateSelect.appendChild(option);
      });

      // ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      const highlightsList = document.getElementById('event-highlights');
      if (event.highlights && event.highlights.length > 0) {
        event.highlights.forEach(h => {
          const li = document.createElement('li');
          li.textContent = h;
          highlightsList.appendChild(li);
        });
      } else {
        highlightsList.parentElement.style.display = 'none';
      }

      // æ³¨æ„äº‹é …
      document.getElementById('event-notes').textContent = event.notes || 'ç‰¹ã«ãªã—';

      // å‚¬è¡Œä¼šç¤¾æƒ…å ±
      if (organizer) {
        document.getElementById('organizer-info').innerHTML = `
          <div style="display: flex; gap: 16px; align-items: flex-start;">
            <img src="${organizer.logo}" alt="${organizer.name}" style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover; background: #f0f0f0;">
            <div>
              <h4 style="margin: 0 0 8px 0;">${organizer.name}</h4>
              <p style="margin: 0; color: #6c7a72; font-size: 0.9rem;">${organizer.description}</p>
              <div style="margin-top: 8px; font-size: 0.85rem; color: #6c7a72;">
                è¨­ç«‹: ${organizer.establishedYear}å¹´ | è©•ä¾¡: â˜…${organizer.rating} (${organizer.reviewCount}ä»¶)
              </div>
            </div>
          </div>
        `;
        document.getElementById('organizer-link').href = `organizer-detail.html?id=${organizer.id}`;
      }

      // å¤–éƒ¨ç”³è¾¼ãƒœã‚¿ãƒ³
      const bookingBtn = document.getElementById('external-booking-btn');
      if (event.externalLink) {
        bookingBtn.href = event.externalLink;
        bookingBtn.textContent = 'å¤–éƒ¨ã‚µã‚¤ãƒˆã§äºˆç´„ã™ã‚‹';
      } else {
        bookingBtn.style.display = 'none';
      }
    } else {
      // ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
      document.querySelector('.page').innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ”</div>
          <h2>ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</h2>
          <p><a href="list.html">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã«æˆ»ã‚‹</a></p>
        </div>
      `;
    }
  </script>
</body>
</html>
